---
name: Branch Protection Reminder

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: read

jobs:
  check-branch-protection:
    runs-on: ubuntu-latest
    name: Verify Branch Protection

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check if branch protection is enabled
        continue-on-error: true
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "üîç Checking branch protection status..."

          # Try to get branch protection info
          REPO="${{ github.repository }}"
          if gh api repos/$REPO/branches/main/protection \
              > /dev/null 2>&1; then
            echo "‚úÖ Branch protection is enabled for main branch"

            # Display current protection settings
            echo ""
            echo "Current protection settings:"
            gh api repos/$REPO/branches/main/protection | jq '{
              require_pull_request_reviews: .required_pull_request_reviews,
              enforce_admins: .enforce_admins.enabled,
              allow_force_pushes: .allow_force_pushes.enabled,
              allow_deletions: .allow_deletions.enabled
            }'
          else
            echo "‚ö†Ô∏è  WARNING: Branch protection is NOT enabled!"
            echo ""
            echo "To protect your main branch:"
            echo "1. Run: ./.github/setup-branch-protection.sh"
            echo "2. Or follow manual setup in BRANCH_PROTECTION.md"
            echo "3. Or visit:"
            echo "   https://github.com/$REPO/settings/branches"
            echo ""
            echo "This prevents:"
            echo "  - Force pushes to main"
            echo "  - Accidental deletion of main"
            echo "  - Direct commits without review"
          fi

      - name: Summary
        if: always()
        run: |
          echo ""
          echo "========================================="
          echo "Branch Protection Check Complete"
          echo "========================================="
          echo ""
          echo "This workflow reminds you to enable branch protection."
          echo "If branch protection is not enabled, please consider:"
          echo "  1. Running: ./.github/setup-branch-protection.sh"
          echo "  2. Following manual setup in BRANCH_PROTECTION.md"
          echo "  3. Visiting: https://github.com/${{ github.repository }}/settings/branches"
          echo ""
          echo "Branch protection helps prevent:"
          echo "  ‚Ä¢ Force pushes to main"
          echo "  ‚Ä¢ Accidental deletion of main"
          echo "  ‚Ä¢ Direct commits without review"
